<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>42 深入模型 | Python-100天从新手到大师</title>


<link rel="stylesheet" href="/python100days/book.min.89885fa0429ec73067282f26fc0c6d38cfc617a443ec4e835d47b821c52c6e92.css" integrity="sha256-iYhfoEKexzBnKC8m/AxtOM/GF6RD7E6DXUe4IcUsbpI=">


<script defer src="/python100days/search.min.60214faf2667d486f5a5c602eb23dff270f5cbd9d003a2a159b89871099dc1b4.js" integrity="sha256-YCFPryZn1Ib1pcYC6yPf8nD1y9nQA6KhWbiYcQmdwbQ="></script>



<link rel="icon" href="/python100days/favicon.png" type="image/x-icon">

<base href="https://ezzdoc.com/python100days/">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://ezzdoc.com/python100days/"><span>Python-100天从新手到大师</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2fpython100days\2f docs\2f Day41-55\2f 42-%E6%B7%B1%E5%85%A5%E6%A8%A1%E5%9E%8B\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/python100days/posts/"><strong>相关文章</strong></a></li>
<li><strong>Day01-15</strong>

<ul>
<li><a href="/python100days/docs/Day01-15/01-%E5%88%9D%E8%AF%86Python/">01.初识Python</a></li>
<li><a href="/python100days/docs/Day01-15/02-%E8%AF%AD%E8%A8%80%E5%85%83%E7%B4%A0/">02.语言元素</a></li>
<li><a href="/python100days/docs/Day01-15/03-%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84/">03.分支结构</a></li>
<li><a href="/python100days/docs/Day01-15/04-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84/">04.循环结构</a></li>
<li><a href="/python100days/docs/Day01-15/05-%E6%9E%84%E9%80%A0%E7%A8%8B%E5%BA%8F%E9%80%BB%E8%BE%91/">05.构造程序逻辑</a></li>
<li><a href="/python100days/docs/Day01-15/06-%E5%87%BD%E6%95%B0%E5%92%8C%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/">06.函数和模块的使用</a></li>
<li><a href="/python100days/docs/Day01-15/07-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">07.字符串和常用数据结构</a></li>
<li><a href="/python100days/docs/Day01-15/08-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">08.面向对象编程基础</a></li>
<li><a href="/python100days/docs/Day01-15/09-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/">09.面向对象进阶</a></li>
<li><a href="/python100days/docs/Day01-15/10-%E5%9B%BE%E5%BD%A2%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E5%92%8C%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">10.图形用户界面和游戏开发</a></li>
<li><a href="/python100days/docs/Day01-15/11-%E6%96%87%E4%BB%B6%E5%92%8C%E5%BC%82%E5%B8%B8/">11.文件和异常</a></li>
<li><a href="/python100days/docs/Day01-15/12-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">12.字符串和正则表达式</a></li>
<li><a href="/python100days/docs/Day01-15/13-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/">13.进程和线程</a></li>
<li><a href="/python100days/docs/Day01-15/14-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%E5%92%8C%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">14.网络编程入门和网络应用开发</a></li>
<li><a href="/python100days/docs/Day01-15/15-%E5%9B%BE%E5%83%8F%E5%92%8C%E5%8A%9E%E5%85%AC%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86/">15.图像和办公文档处理</a></li>
</ul></li>
<li><strong>Day16-20</strong>

<ul>
<li><a href="/python100days/docs/Day16-20/16-20-Python%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/">16-20.Python语言进阶</a></li>
</ul></li>
<li><strong>Day21-30</strong>

<ul>
<li><a href="/python100days/docs/Day21-30/21-30-Web%E5%89%8D%E7%AB%AF%E6%A6%82%E8%BF%B0/">21-30.Web前端概述</a></li>
</ul></li>
<li><strong>Day31-35</strong>

<ul>
<li><a href="/python100days/docs/Day31-35/31-35-%E7%8E%A9%E8%BD%ACLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">31-35.玩转Linux操作系统</a></li>
</ul></li>
<li><strong>Day36-40</strong>

<ul>
<li><a href="/python100days/docs/Day36-40/36-38-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93MySQL/">36-38.关系型数据库MySQL</a></li>
<li><a href="/python100days/docs/Day36-40/39-40-NoSQL%E5%85%A5%E9%97%A8/">39-40.NoSQL入门</a></li>
</ul></li>
<li><strong>Day41-55</strong>

<ul>
<li><a href="/python100days/docs/Day41-55/41-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">41.快速上手</a></li>
<li><a href="/python100days/docs/Day41-55/42-%E6%B7%B1%E5%85%A5%E6%A8%A1%E5%9E%8B/">42.深入模型</a></li>
<li><a href="/python100days/docs/Day41-55/43-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%92%8CAjax%E8%AF%B7%E6%B1%82/">43.静态资源和Ajax请求</a></li>
<li><a href="/python100days/docs/Day41-55/44-%E8%A1%A8%E5%8D%95%E7%9A%84%E5%BA%94%E7%94%A8/">44.表单的应用</a></li>
<li><a href="/python100days/docs/Day41-55/45-Cookie%E5%92%8CSession/">45.Cookie和Session</a></li>
<li><a href="/python100days/docs/Day41-55/46-%E6%8A%A5%E8%A1%A8%E5%92%8C%E6%97%A5%E5%BF%97/">46.报表和日志</a></li>
<li><a href="/python100days/docs/Day41-55/47-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%BA%94%E7%94%A8/">47.中间件的应用</a></li>
<li><a href="/python100days/docs/Day41-55/48-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/">48.前后端分离开发入门</a></li>
<li><a href="/python100days/docs/Day41-55/49-RESTful%E6%9E%B6%E6%9E%84%E5%92%8CDRF%E5%85%A5%E9%97%A8/">49.RESTful架构和DRF入门</a></li>
<li><a href="/python100days/docs/Day41-55/50-RESTful%E6%9E%B6%E6%9E%84%E5%92%8CDRF%E8%BF%9B%E9%98%B6/">50.RESTful架构和DRF进阶</a></li>
<li><a href="/python100days/docs/Day41-55/51-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98/">51.使用缓存</a></li>
<li><a href="/python100days/docs/Day41-55/52-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91/">52.文件上传和富文本编辑</a></li>
<li><a href="/python100days/docs/Day41-55/53-%E7%9F%AD%E4%BF%A1%E5%92%8C%E9%82%AE%E4%BB%B6/">53.短信和邮件</a></li>
<li><a href="/python100days/docs/Day41-55/54-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/">54.异步任务和定时任务</a></li>
<li><a href="/python100days/docs/Day41-55/55-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/">55.单元测试和项目上线</a></li>
</ul></li>
<li><strong>Day56-60</strong>

<ul>
<li><a href="/python100days/docs/Day56-60/56-Flask%E5%85%A5%E9%97%A8/">56.Flask入门</a></li>
<li><a href="/python100days/docs/Day56-60/57-%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8/">57.模板的使用</a></li>
<li><a href="/python100days/docs/Day56-60/58-%E8%A1%A8%E5%8D%95%E7%9A%84%E5%A4%84%E7%90%86/">58.表单的处理</a></li>
<li><a href="/python100days/docs/Day56-60/59-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/">59.数据库操作</a></li>
<li><a href="/python100days/docs/Day56-60/60-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">60.项目实战</a></li>
</ul></li>
<li><strong>Day61-65</strong>

<ul>
<li><a href="/python100days/docs/Day61-65/61-%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/">61.预备知识</a></li>
<li><a href="/python100days/docs/Day61-65/62-Tornado%E5%85%A5%E9%97%A8/">62.Tornado入门</a></li>
<li><a href="/python100days/docs/Day61-65/63-%E5%BC%82%E6%AD%A5%E5%8C%96/">63.异步化</a></li>
<li><a href="/python100days/docs/Day61-65/64-WebSocket%E7%9A%84%E5%BA%94%E7%94%A8/">64.WebSocket的应用</a></li>
<li><a href="/python100days/docs/Day61-65/65-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">65.项目实战</a></li>
</ul></li>
<li><strong>Day66-75</strong>

<ul>
<li><a href="/python100days/docs/Day66-75/66-%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%92%8C%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7/">66.网络爬虫和相关工具</a></li>
<li><a href="/python100days/docs/Day66-75/67-%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%92%8C%E8%A7%A3%E6%9E%90/">67.数据采集和解析</a></li>
<li><a href="/python100days/docs/Day66-75/68-%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE/">68.存储数据</a></li>
<li><a href="/python100days/docs/Day66-75/69-%E5%B9%B6%E5%8F%91%E4%B8%8B%E8%BD%BD/">69.并发下载</a></li>
<li><a href="/python100days/docs/Day66-75/70-%E8%A7%A3%E6%9E%90%E5%8A%A8%E6%80%81%E5%86%85%E5%AE%B9/">70.解析动态内容</a></li>
<li><a href="/python100days/docs/Day66-75/71-%E8%A1%A8%E5%8D%95%E4%BA%A4%E4%BA%92%E5%92%8C%E9%AA%8C%E8%AF%81%E7%A0%81%E5%A4%84%E7%90%86/">71.表单交互和验证码处理</a></li>
<li><a href="/python100days/docs/Day66-75/72-Scrapy%E5%85%A5%E9%97%A8/">72.Scrapy入门</a></li>
<li><a href="/python100days/docs/Day66-75/73-Scrapy%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/">73.Scrapy高级应用</a></li>
<li><a href="/python100days/docs/Day66-75/74-Scrapy%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9E%E7%8E%B0/">74.Scrapy分布式实现</a></li>
<li><a href="/python100days/docs/Day66-75/75-%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">75.爬虫项目实战</a></li>
</ul></li>
<li><strong>Day76-90</strong>

<ul>
<li><a href="/python100days/docs/Day76-90/76-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/">76.机器学习基础</a></li>
<li><a href="/python100days/docs/Day76-90/77-Pandas%E7%9A%84%E5%BA%94%E7%94%A8/">77.Pandas的应用</a></li>
<li><a href="/python100days/docs/Day76-90/78-NumPy%E5%92%8CSciPy%E7%9A%84%E5%BA%94%E7%94%A8/">78.NumPy和SciPy的应用</a></li>
<li><a href="/python100days/docs/Day76-90/79-Matplotlib%E5%92%8C%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">79.Matplotlib和数据可视化</a></li>
<li><a href="/python100days/docs/Day76-90/80-k%E6%9C%80%E8%BF%91%E9%82%BB%E5%88%86%E7%B1%BB/">80.k最近邻分类</a></li>
<li><a href="/python100days/docs/Day76-90/81-%E5%86%B3%E7%AD%96%E6%A0%91/">81.决策树</a></li>
<li><a href="/python100days/docs/Day76-90/82-%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB/">82.贝叶斯分类</a></li>
<li><a href="/python100days/docs/Day76-90/83-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/">83.支持向量机</a></li>
<li><a href="/python100days/docs/Day76-90/84-K-%E5%9D%87%E5%80%BC%E8%81%9A%E7%B1%BB/">84.K-均值聚类</a></li>
<li><a href="/python100days/docs/Day76-90/85-%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/">85.回归分析</a></li>
<li><a href="/python100days/docs/Day76-90/86-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%85%A5%E9%97%A8/">86.大数据分析入门</a></li>
<li><a href="/python100days/docs/Day76-90/87-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E8%BF%9B%E9%98%B6/">87.大数据分析进阶</a></li>
<li><a href="/python100days/docs/Day76-90/88-Tensorflow%E5%85%A5%E9%97%A8/">88.Tensorflow入门</a></li>
<li><a href="/python100days/docs/Day76-90/89-Tensorflow%E5%AE%9E%E6%88%98/">89.Tensorflow实战</a></li>
<li><a href="/python100days/docs/Day76-90/90-%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98/">90.推荐系统实战</a></li>
</ul></li>
<li><strong>Day91-100</strong>

<ul>
<li><a href="/python100days/docs/Day91-100/91-%E5%9B%A2%E9%98%9F%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87/">91.团队项目开发准备</a></li>
<li><a href="/python100days/docs/Day91-100/92-%E4%BD%BF%E7%94%A8Docker%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/">92.使用Docker部署服务</a></li>
<li><a href="/python100days/docs/Day91-100/93-MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">93.MySQL性能优化</a></li>
<li><a href="/python100days/docs/Day91-100/94-%E7%BD%91%E7%BB%9CAPI%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/">94.网络API接口设计</a></li>
<li><a href="/python100days/docs/Day91-100/95-%E4%BD%BF%E7%94%A8Django%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%A1%B9%E7%9B%AE/">95.使用Django开发商业项目</a></li>
<li><a href="/python100days/docs/Day91-100/96-%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">96.软件测试和自动化测试</a></li>
<li><a href="/python100days/docs/Day91-100/97-%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9%E5%89%96%E6%9E%90/">97.电商网站技术要点剖析</a></li>
<li><a href="/python100days/docs/Day91-100/98-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF%E5%92%8C%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/">98.项目部署上线和性能调优</a></li>
<li><a href="/python100days/docs/Day91-100/99-%E9%9D%A2%E8%AF%95%E4%B8%AD%E7%9A%84%E5%85%AC%E5%85%B1%E9%97%AE%E9%A2%98/">99.面试中的公共问题</a></li>
<li><a href="/python100days/docs/Day91-100/100-%E8%8B%B1%E8%AF%AD%E9%9D%A2%E8%AF%95/">100.英语面试</a></li>
</ul></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/python100days/svg/menu.svg" alt="Menu" />
  </label>
  <strong>42 深入模型</strong>
</header>

      
<article class="markdown">

<h1 id="深入模型">深入模型</h1>

<p>在上一个章节中，我们提到了Django是基于MVC架构的Web框架，MVC架构追求的是“模型”和“视图”的解耦合。所谓“模型”说得更直白一些就是数据（的表示），所以通常也被称作“数据模型”。在实际的项目中，数据模型通常通过数据库实现持久化操作，而关系型数据库在过去和当下都是持久化的首选方案，下面我们以MySQL为例来说明如何使用关系型数据库来实现持久化操作。</p>

<h2 id="配置关系型数据库mysql">配置关系型数据库MySQL</h2>

<p>我们继续来完善上一个章节中的OA项目，首先从配置项目使用的数据库开始。</p>

<ol>
<li><p>修改项目的settings.py文件，首先将我们之前创建的应用hrs添加已安装的项目中，然后配置MySQL作为持久化方案。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ vim oa/settings.py</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#75715e"># 此处省略上面的代码</span>

INSTALLED_APPS <span style="color:#f92672">=</span> [
   <span style="color:#e6db74">&#39;django.contrib.admin&#39;</span>,
   <span style="color:#e6db74">&#39;django.contrib.auth&#39;</span>,
   <span style="color:#e6db74">&#39;django.contrib.contenttypes&#39;</span>,
   <span style="color:#e6db74">&#39;django.contrib.sessions&#39;</span>,
   <span style="color:#e6db74">&#39;django.contrib.messages&#39;</span>,
   <span style="color:#e6db74">&#39;django.contrib.staticfiles&#39;</span>,
   <span style="color:#e6db74">&#39;hrs&#39;</span>,
]

DATABASES <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#39;default&#39;</span>: {
       <span style="color:#e6db74">&#39;ENGINE&#39;</span>: <span style="color:#e6db74">&#39;django.db.backends.mysql&#39;</span>,
       <span style="color:#e6db74">&#39;NAME&#39;</span>: <span style="color:#e6db74">&#39;oa&#39;</span>,
       <span style="color:#e6db74">&#39;HOST&#39;</span>: <span style="color:#e6db74">&#39;127.0.0.1&#39;</span>,
       <span style="color:#e6db74">&#39;PORT&#39;</span>: <span style="color:#ae81ff">3306</span>,
       <span style="color:#e6db74">&#39;USER&#39;</span>: <span style="color:#e6db74">&#39;root&#39;</span>,
       <span style="color:#e6db74">&#39;PASSWORD&#39;</span>: <span style="color:#e6db74">&#39;123456&#39;</span>,
   }
}

<span style="color:#75715e"># 此处省略下面的代码</span></code></pre></div></li>
</ol>

<p>在配置ENGINE属性时，常用的可选值包括：</p>

<ul>
<li><code>'django.db.backends.sqlite3'</code>：SQLite嵌入式数据库。</li>
<li><code>'django.db.backends.postgresql'</code>：BSD许可证下发行的开源关系型数据库产品。</li>
<li><code>'django.db.backends.mysql'</code>：转手多次目前属于甲骨文公司的经济高效的数据库产品。</li>
<li><code>'django.db.backends.oracle'</code>：甲骨文公司的关系型数据库旗舰产品。</li>
</ul>

<p>其他的配置可以参考官方文档中<a href="https://docs.djangoproject.com/zh-hans/2.0/ref/databases/#third-party-notes">数据库配置</a>的部分。</p>

<p>NAME属性代表数据库的名称，如果使用SQLite它对应着一个文件，在这种情况下NAME的属性值应该是一个绝对路径；使用其他关系型数据库，则要配置对应的HOST（主机）、PORT（端口）、USER（用户名）、PASSWORD（口令）等属性。</p>

<ol>
<li><p>安装Python操作MySQL的依赖库，Python 3中通常使用PyMySQL，Python 2中通常用MySQLdb。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ pip install pymysql</code></pre></div></li>
</ol>

<p>如果使用Python 3需要修改<strong>项目目录</strong>下的<code>__init__.py</code>文件并加入如下所示的代码，这段代码的作用是将PyMySQL视为MySQLdb来使用，从而避免Django找不到连接MySQL的客户端工具而询问你：“Did you install mysqlclient? ”（你安装了mysqlclient吗？）。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">   <span style="color:#f92672">import</span> pymysql

   pymysql<span style="color:#f92672">.</span>install_as_MySQLdb()</code></pre></div>
<ol>
<li><p>如果之前没有为应用程序创建数据库，那么现在是时候创建名为oa的数据库了。在MySQL中创建数据库的SQL语句如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> oa <span style="color:#66d9ef">default</span> charset utf8;</code></pre></div></li>

<li><p>Django框架本身有自带的数据模型，我们稍后会用到这些模型，为此我们先做一次迁移操作。所谓迁移，就是根据模型自动生成关系数据库中的二维表，命令如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ python manage.py migrate
Operations to perform:
 Apply all migrations: admin, auth, contenttypes, sessions
Running migrations:
 Applying contenttypes.0001_initial... OK
 Applying auth.0001_initial... OK
 Applying admin.0001_initial... OK
 Applying admin.0002_logentry_remove_auto_add... OK
 Applying contenttypes.0002_remove_content_type_name... OK
 Applying auth.0002_alter_permission_name_max_length... OK
 Applying auth.0003_alter_user_email_max_length... OK
 Applying auth.0004_alter_user_username_opts... OK
 Applying auth.0005_alter_user_last_login_null... OK
 Applying auth.0006_require_contenttypes_0002... OK
 Applying auth.0007_alter_validators_add_error_messages... OK
 Applying auth.0008_alter_user_username_max_length... OK
 Applying auth.0009_alter_user_last_name_max_length... OK
 Applying sessions.0001_initial... OK</code></pre></div></li>

<li><p>接下来，我们为自己的应用创建数据模型。如果要在hrs应用中实现对部门和员工的管理，我们可以先创建部门和员工数据模型，代码如下所示。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ vim hrs/models.py</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dept</span>(models<span style="color:#f92672">.</span>Model):
   <span style="color:#e6db74">&#34;&#34;&#34;部门类&#34;&#34;&#34;</span>

   no <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(primary_key<span style="color:#f92672">=</span>True, db_column<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dno&#39;</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;部门编号&#39;</span>)
   name <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, db_column<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dname&#39;</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;部门名称&#39;</span>)
   location <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, db_column<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dloc&#39;</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;部门所在地&#39;</span>)

   <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
       db_table <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;tb_dept&#39;</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Emp</span>(models<span style="color:#f92672">.</span>Model):
   <span style="color:#e6db74">&#34;&#34;&#34;员工类&#34;&#34;&#34;</span>

   no <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(primary_key<span style="color:#f92672">=</span>True, db_column<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;eno&#39;</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;员工编号&#39;</span>)
   name <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, db_column<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ename&#39;</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;员工姓名&#39;</span>)
   job <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;职位&#39;</span>)
   <span style="color:#75715e"># 多对一外键关联(自参照)</span>
   mgr <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(<span style="color:#e6db74">&#39;self&#39;</span>, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>SET_NULL, null<span style="color:#f92672">=</span>True, blank<span style="color:#f92672">=</span>True, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;主管&#39;</span>)
   sal <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>DecimalField(max_digits<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>, decimal_places<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;月薪&#39;</span>)
   comm <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>DecimalField(max_digits<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>, decimal_places<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, null<span style="color:#f92672">=</span>True, blank<span style="color:#f92672">=</span>True, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;补贴&#39;</span>)
   <span style="color:#75715e"># 多对一外键关联(参照部门模型)</span>
   dept <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Dept, db_column<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dno&#39;</span>, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>PROTECT, verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;所在部门&#39;</span>)

   <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
       db_table <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;tb_emp&#39;</span></code></pre></div></li>
</ol>

<blockquote>
<p>说明：上面定义模型时使用了字段类及其属性，其中IntegerField对应数据库中的integer类型，CharField对应数据库的varchar类型，DecimalField对应数据库的decimal类型，ForeignKey用来建立多对一外键关联。字段属性primary_key用于设置主键，max_length用来设置字段的最大长度，db_column用来设置数据库中与字段对应的列，verbose_name则设置了Django后台管理系统中该字段显示的名称。如果对这些东西感到很困惑也不要紧，文末提供了字段类、字段属性、元数据选项等设置的相关说明，不清楚的读者可以稍后查看对应的参考指南。</p>
</blockquote>

<ol>
<li><p>再次执行迁移操作，先通过模型生成迁移文件，再执行迁移创建二维表。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ python manage.py makemigrations hrs
Migrations <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;hrs&#39;</span>:
 hrs/migrations/0001_initial.py
   - Create model Dept
   - Create model Emp
<span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ python manage.py migrate
Operations to perform:
 Apply all migrations: admin, auth, contenttypes, hrs, sessions
Running migrations:
 Applying hrs.0001_initial... OK</code></pre></div></li>
</ol>

<p>执行完数据模型迁移操作之后，可以在通过图形化的MySQL客户端工具查看到E-R图（实体关系图）。</p>

<p><img src="Day41-55/res/er-graph.png" alt="" /></p>

<h2 id="利用django后台管理模型">利用Django后台管理模型</h2>

<p>Django框架有自带的后台管理系统来实现对模型的管理。虽然实际应用中，这个后台可能并不能满足我们的需求，但是在学习Django框架时，我们暂时可以利用Django自带的后台管理系统来管理我们的模型，同时也可以了解一个项目的后台管理系统到底需要哪些功能。</p>

<ol>
<li><p>创建超级管理员账号。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ python manage.py createsuperuser
Username <span style="color:#f92672">(</span>leave blank to use <span style="color:#e6db74">&#39;hao&#39;</span><span style="color:#f92672">)</span>: jackfrued
Email address: jackfrued@126.com
Password:
Password <span style="color:#f92672">(</span>again<span style="color:#f92672">)</span>:
Superuser created successfully.</code></pre></div></li>

<li><p>启动Web服务器，登录后台管理系统。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ python manage.py runserver</code></pre></div></li>
</ol>

<p>访问<a href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a>，会来到如下图所示的登录界面。</p>

<p><img src="Day41-55/res/admin-login.png" alt="" /></p>

<p>登录后进入管理员操作平台。</p>

<p><img src="Day41-55/res/admin-welcome.png" alt="" /></p>

<p>至此我们还没有看到之前创建的模型类，需要在应用的admin.py文件中模型进行注册。</p>

<ol>
<li><p>注册模型类。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ vim hrs/admin.py</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin

<span style="color:#f92672">from</span> hrs.models <span style="color:#f92672">import</span> Emp, Dept

admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Dept)
admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Emp)</code></pre></div></li>
</ol>

<p>注册模型类后，就可以在后台管理系统中看到它们。</p>

<p><img src="Day41-55/res/admin-model.png" alt="" /></p>

<ol>
<li>对模型进行CRUD操作。</li>
</ol>

<p>可以在管理员平台对模型进行C（新增）、R（查看）、U（更新）、D（删除）操作，如下图所示。</p>

<ul>
<li>添加新的部门。</li>
</ul>

<p><img src="Day41-55/res/admin-model-create.png" alt="" /></p>

<ul>
<li>查看所有部门。</li>
</ul>

<p><img src="Day41-55/res/admin-model-read.png" alt="" /></p>

<ul>
<li>更新和删除部门。</li>
</ul>

<p><img src="Day41-55/res/admin-model-delete-and-update.png" alt="" /></p>

<ol>
<li>注册模型管理类。</li>
</ol>

<p>可能大家已经注意到了，刚才在后台查看部门信息的时候，显示的部门信息并不直观，为此我们再修改admin.py文件，通过注册模型管理类，可以在后台管理系统中更好的管理模型。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">   <span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin

   <span style="color:#f92672">from</span> hrs.models <span style="color:#f92672">import</span> Emp, Dept


   <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DeptAdmin</span>(admin<span style="color:#f92672">.</span>ModelAdmin):

       list_display <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;no&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;location&#39;</span>)
       ordering <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;no&#39;</span>, )


   <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmpAdmin</span>(admin<span style="color:#f92672">.</span>ModelAdmin):

       list_display <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;no&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;job&#39;</span>, <span style="color:#e6db74">&#39;mgr&#39;</span>, <span style="color:#e6db74">&#39;sal&#39;</span>, <span style="color:#e6db74">&#39;comm&#39;</span>, <span style="color:#e6db74">&#39;dept&#39;</span>)
       search_fields <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;job&#39;</span>)


   admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Dept, DeptAdmin)
   admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Emp, EmpAdmin)</code></pre></div>
<p><img src="Day41-55/res/admin-model-depts.png" alt="" /></p>

<p><img src="Day41-55/res/admin-model-emps.png" alt="" /></p>

<p>为了更好的查看模型数据，可以为Dept和Emp两个模型类添加<code>__str__</code>魔法方法。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">   <span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models


   <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dept</span>(models<span style="color:#f92672">.</span>Model):
       <span style="color:#e6db74">&#34;&#34;&#34;部门类&#34;&#34;&#34;</span>

       <span style="color:#75715e"># 此处省略上面的代码</span>

       <span style="color:#66d9ef">def</span> __str__(self):
           <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>name

       <span style="color:#75715e"># 此处省略下面的代码</span>


   <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Emp</span>(models<span style="color:#f92672">.</span>Model):
       <span style="color:#e6db74">&#34;&#34;&#34;员工类&#34;&#34;&#34;</span>

       <span style="color:#75715e"># 此处省略上面的代码</span>

       <span style="color:#66d9ef">def</span> __str__(self):
           <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>name

       <span style="color:#75715e"># 此处省略下面的代码</span></code></pre></div>
<p>修改代码后刷新查看Emp模型的页面，效果如下图所示。</p>

<p><img src="Day41-55/res/admin-model-emps-modified.png" alt="" /></p>

<h2 id="使用orm完成模型的crud操作">使用ORM完成模型的CRUD操作</h2>

<p>在了解了Django提供的模型管理平台之后，我们来看看如何从代码层面完成对模型的CRUD（Create / Read / Update / Delete）操作。我们可以通过manage.py开启Shell交互式环境，然后使用Django内置的ORM框架对模型进行CRUD操作。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#f92672">(</span>venv<span style="color:#f92672">)</span>$ python manage.py shell
Python <span style="color:#ae81ff">3</span>.6.4 <span style="color:#f92672">(</span>v3.6.4:d48ecebad5, Dec <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">2017</span>, <span style="color:#ae81ff">21</span>:07:28<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>GCC <span style="color:#ae81ff">4</span>.2.1 <span style="color:#f92672">(</span>Apple Inc. build <span style="color:#ae81ff">5666</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>dot <span style="color:#ae81ff">3</span><span style="color:#f92672">)]</span> on darwin
Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> or <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information.
<span style="color:#f92672">(</span>InteractiveConsole<span style="color:#f92672">)</span>
&gt;&gt;&gt;</code></pre></div>
<h3 id="新增">新增</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; from hrs.models import Dept, Emp
&gt;&gt;&gt;
&gt;&gt;&gt; dept <span style="color:#f92672">=</span> Dept<span style="color:#f92672">(</span><span style="color:#ae81ff">40</span>, <span style="color:#e6db74">&#39;研发2部&#39;</span>, <span style="color:#e6db74">&#39;深圳&#39;</span><span style="color:#f92672">)</span>
&gt;&gt;&gt; dept.save<span style="color:#f92672">()</span></code></pre></div>
<h3 id="更新">更新</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; dept.name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;研发3部&#39;</span>
&gt;&gt;&gt; dept.save<span style="color:#f92672">()</span></code></pre></div>
<h3 id="查询">查询</h3>

<ol>
<li><p>查询所有对象。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Dept.objects.all<span style="color:#f92672">()</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发1部&gt;, &lt;Dept: 销售1部&gt;, &lt;Dept: 运维1部&gt;, &lt;Dept: 研发3部&gt;<span style="color:#f92672">]</span>&gt;</code></pre></div></li>

<li><p>过滤数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Dept.objects.filter<span style="color:#f92672">(</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;研发3部&#39;</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 查询部门名称为“研发3部”的部门</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发3部&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.filter<span style="color:#f92672">(</span>name__contains<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;研发&#39;</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 查询部门名称包含“研发”的部门(模糊查询)</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发1部&gt;, &lt;Dept: 研发3部&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.filter<span style="color:#f92672">(</span>no__gt<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span>.filter<span style="color:#f92672">(</span>no__lt<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 查询部门编号大于10小于40的部门</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 销售1部&gt;, &lt;Dept: 运维1部&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.filter<span style="color:#f92672">(</span>no__range<span style="color:#f92672">=(</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">30</span><span style="color:#f92672">))</span> <span style="color:#75715e"># 查询部门编号在10到30之间的部门</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发1部&gt;, &lt;Dept: 销售1部&gt;, &lt;Dept: 运维1部&gt;<span style="color:#f92672">]</span>&gt;</code></pre></div></li>

<li><p>查询单个对象。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Dept.objects.get<span style="color:#f92672">(</span>pk<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span>
&lt;Dept: 研发1部&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.get<span style="color:#f92672">(</span>no<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span><span style="color:#f92672">)</span>
&lt;Dept: 销售1部&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.get<span style="color:#f92672">(</span>no__exact<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span><span style="color:#f92672">)</span>
&lt;Dept: 运维1部&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.filter<span style="color:#f92672">(</span>no<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span>.first<span style="color:#f92672">()</span>
&lt;Dept: 研发1部&gt;</code></pre></div></li>

<li><p>排序数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Dept.objects.order_by<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;no&#39;</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 查询所有部门按部门编号升序排列</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发1部&gt;, &lt;Dept: 销售1部&gt;, &lt;Dept: 运维1部&gt;, &lt;Dept: 研发3部&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.order_by<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;-no&#39;</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 查询所有部门按部门编号降序排列</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发3部&gt;, &lt;Dept: 运维1部&gt;, &lt;Dept: 销售1部&gt;, &lt;Dept: 研发1部&gt;<span style="color:#f92672">]</span>&gt;</code></pre></div></li>

<li><p>数据切片（分页查询）。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Dept.objects.order_by<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;no&#39;</span><span style="color:#f92672">)[</span><span style="color:#ae81ff">0</span>:2<span style="color:#f92672">]</span> <span style="color:#75715e"># 按部门编号排序查询1~2部门</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 研发1部&gt;, &lt;Dept: 销售1部&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.order_by<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;no&#39;</span><span style="color:#f92672">)[</span><span style="color:#ae81ff">2</span>:4<span style="color:#f92672">]</span> <span style="color:#75715e"># 按部门编号排序查询3~4部门</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Dept: 运维1部&gt;, &lt;Dept: 研发3部&gt;<span style="color:#f92672">]</span>&gt;</code></pre></div></li>

<li><p>高级查询。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Emp.objects.filter<span style="color:#f92672">(</span>dept__no<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 根据部门编号查询该部门的员工</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Emp: 乔峰&gt;, &lt;Emp: 张无忌&gt;, &lt;Emp: 张三丰&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Emp.objects.filter<span style="color:#f92672">(</span>dept__name__contains<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;销售&#39;</span><span style="color:#f92672">)</span> <span style="color:#75715e"># 查询名字包含“销售”的部门的员工</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Emp: 黄蓉&gt;<span style="color:#f92672">]</span>&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Dept.objects.get<span style="color:#f92672">(</span>pk<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span>.emp_set.all<span style="color:#f92672">()</span> <span style="color:#75715e"># 通过部门反查部门所有的员工</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Emp: 乔峰&gt;, &lt;Emp: 张无忌&gt;, &lt;Emp: 张三丰&gt;<span style="color:#f92672">]</span>&gt;</code></pre></div></li>
</ol>

<blockquote>
<p>说明1：由于员工与部门之间存在多对一外键关联，所以也能通过部门反向查询该部门的员工（从一对多关系中“一”的一方查询“多”的一方），反向查询属性默认的名字是<code>类名小写_set</code>（如上面例子中的<code>emp_set</code>），当然也可以在创建模型时通过<code>ForeingKey</code>的<code>related_name</code>属性指定反向查询属性的名字。如果不希望执行反向查询可以将<code>related_name</code>属性设置为<code>'+'</code>或以<code>'+'</code>开头的字符串。</p>

<p>说明2：查询多个对象的时候返回的是QuerySet对象，QuerySet使用了惰性查询，即在创建QuerySet对象的过程中不涉及任何数据库活动，等真正用到对象时（求值QuerySet）才向数据库发送SQL语句并获取对应的结果，这一点在实际开发中需要引起注意！</p>

<p>说明3：可以在QuerySet上使用<code>update()</code>方法一次更新多个对象。</p>
</blockquote>

<h3 id="删除">删除</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; Dept.objects.get<span style="color:#f92672">(</span>pk<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span><span style="color:#f92672">)</span>.delete<span style="color:#f92672">()</span>
<span style="color:#f92672">(</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">{</span><span style="color:#e6db74">&#39;hrs.Dept&#39;</span>: <span style="color:#ae81ff">1</span><span style="color:#f92672">})</span></code></pre></div>
<h2 id="django模型最佳实践">Django模型最佳实践</h2>

<ol>
<li>正确的为模型和关系字段命名。</li>
<li>设置适当的<code>related_name</code>属性。</li>
<li>用<code>OneToOneField</code>代替<code>ForeignKeyField(unique=True)</code>。</li>
<li>通过“迁移操作”（migrate）来添加模型。</li>
<li>用NoSQL来应对需要降低范式级别的场景。</li>
<li>如果布尔类型可以为空要使用<code>NullBooleanField</code>。</li>
<li>在模型中放置业务逻辑。</li>
<li>用<code>&lt;ModelName&gt;.DoesNotExists</code>取代<code>ObjectDoesNotExists</code>。</li>
<li>在数据库中不要出现无效数据。</li>
<li>不要对<code>QuerySet</code>调用<code>len()</code>函数。</li>
<li>将<code>QuerySet</code>的<code>exists()</code>方法的返回值用于<code>if</code>条件。</li>
<li>用<code>DecimalField</code>来存储货币相关数据而不是<code>FloatField</code>。</li>
<li>定义<code>__str__</code>方法。</li>
<li>不要将数据文件放在同一个目录中。</li>
</ol>

<blockquote>
<p>说明：以上内容来自于STEELKIWI网站的<a href="https://steelkiwi.com/blog/best-practices-working-django-models-python/"><em>Best Practice working with Django models in Python</em></a>，有兴趣的小伙伴可以阅读原文。</p>
</blockquote>

<h2 id="模型定义参考">模型定义参考</h2>

<h3 id="字段">字段</h3>

<p>对字段名称的限制</p>

<ul>
<li>字段名不能是Python的保留字，否则会导致语法错误</li>
<li>字段名不能有多个连续下划线，否则影响ORM查询操作</li>
</ul>

<p>Django模型字段类</p>

<table>
<thead>
<tr>
<th>字段类</th>
<th>说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>AutoField</td>
<td>自增ID字段</td>
</tr>

<tr>
<td>BigIntegerField</td>
<td>64位有符号整数</td>
</tr>

<tr>
<td>BinaryField</td>
<td>存储二进制数据的字段，对应Python的bytes类型</td>
</tr>

<tr>
<td>BooleanField</td>
<td>存储True或False</td>
</tr>

<tr>
<td>CharField</td>
<td>长度较小的字符串</td>
</tr>

<tr>
<td>DateField</td>
<td>存储日期，有auto_now和auto_now_add属性</td>
</tr>

<tr>
<td>DateTimeField</td>
<td>存储日期和日期，两个附加属性同上</td>
</tr>

<tr>
<td>DecimalField</td>
<td>存储固定精度小数，有max_digits（有效位数）和decimal_places（小数点后面）两个必要的参数</td>
</tr>

<tr>
<td>DurationField</td>
<td>存储时间跨度</td>
</tr>

<tr>
<td>EmailField</td>
<td>与CharField相同，可以用EmailValidator验证</td>
</tr>

<tr>
<td>FileField</td>
<td>文件上传字段</td>
</tr>

<tr>
<td>FloatField</td>
<td>存储浮点数</td>
</tr>

<tr>
<td>ImageField</td>
<td>其他同FileFiled，要验证上传的是不是有效图像</td>
</tr>

<tr>
<td>IntegerField</td>
<td>存储32位有符号整数。</td>
</tr>

<tr>
<td>GenericIPAddressField</td>
<td>存储IPv4或IPv6地址</td>
</tr>

<tr>
<td>NullBooleanField</td>
<td>存储True、False或null值</td>
</tr>

<tr>
<td>PositiveIntegerField</td>
<td>存储无符号整数（只能存储正数）</td>
</tr>

<tr>
<td>SlugField</td>
<td>存储slug（简短标注）</td>
</tr>

<tr>
<td>SmallIntegerField</td>
<td>存储16位有符号整数</td>
</tr>

<tr>
<td>TextField</td>
<td>存储数据量较大的文本</td>
</tr>

<tr>
<td>TimeField</td>
<td>存储时间</td>
</tr>

<tr>
<td>URLField</td>
<td>存储URL的CharField</td>
</tr>

<tr>
<td>UUIDField</td>
<td>存储全局唯一标识符</td>
</tr>
</tbody>
</table>

<h3 id="字段属性">字段属性</h3>

<p>通用字段属性</p>

<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>null</td>
<td>数据库中对应的字段是否允许为NULL，默认为False</td>
</tr>

<tr>
<td>blank</td>
<td>后台模型管理验证数据时，是否允许为NULL，默认为False</td>
</tr>

<tr>
<td>choices</td>
<td>设定字段的选项，各元组中的第一个值是设置在模型上的值，第二值是人类可读的值</td>
</tr>

<tr>
<td>db_column</td>
<td>字段对应到数据库表中的列名，未指定时直接使用字段的名称</td>
</tr>

<tr>
<td>db_index</td>
<td>设置为True时将在该字段创建索引</td>
</tr>

<tr>
<td>db_tablespace</td>
<td>为有索引的字段设置使用的表空间，默认为DEFAULT_INDEX_TABLESPACE</td>
</tr>

<tr>
<td>default</td>
<td>字段的默认值</td>
</tr>

<tr>
<td>editable</td>
<td>字段在后台模型管理或ModelForm中是否显示，默认为True</td>
</tr>

<tr>
<td>error_messages</td>
<td>设定字段抛出异常时的默认消息的字典，其中的键包括null、blank、invalid、invalid_choice、unique和unique_for_date</td>
</tr>

<tr>
<td>help_text</td>
<td>表单小组件旁边显示的额外的帮助文本。</td>
</tr>

<tr>
<td>primary_key</td>
<td>将字段指定为模型的主键，未指定时会自动添加AutoField用于主键，只读。</td>
</tr>

<tr>
<td>unique</td>
<td>设置为True时，表中字段的值必须是唯一的</td>
</tr>

<tr>
<td>verbose_name</td>
<td>字段在后台模型管理显示的名称，未指定时使用字段的名称</td>
</tr>
</tbody>
</table>

<p>ForeignKey属性</p>

<ol>
<li>limit_choices_to：值是一个Q对象或返回一个Q对象，用于限制后台显示哪些对象。</li>
<li>related_name：用于获取关联对象的关联管理器对象（反向查询），如果不允许反向，该属性应该被设置为<code>'+'</code>，或者以<code>'+'</code>结尾。</li>
<li>to_field：指定关联的字段，默认关联对象的主键字段。</li>
<li>db_constraint：是否为外键创建约束，默认值为True。</li>
<li>on_delete：外键关联的对象被删除时对应的动作，可取的值包括django.db.models中定义的：

<ul>
<li>CASCADE：级联删除。</li>
<li>PROTECT：抛出ProtectedError异常，阻止删除引用的对象。</li>
<li>SET_NULL：把外键设置为null，当null属性被设置为True时才能这么做。</li>
<li>SET_DEFAULT：把外键设置为默认值，提供了默认值才能这么做。</li>
</ul></li>
</ol>

<p>ManyToManyField属性</p>

<ol>
<li>symmetrical：是否建立对称的多对多关系。</li>
<li>through：指定维持多对多关系的中间表的Django模型。</li>
<li>throughfields：定义了中间模型时可以指定建立多对多关系的字段。</li>
<li>db_table：指定维持多对多关系的中间表的表名。</li>
</ol>

<h3 id="模型元数据选项">模型元数据选项</h3>

<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>abstract</td>
<td>设置为True时模型是抽象父类</td>
</tr>

<tr>
<td>app_label</td>
<td>如果定义模型的应用不在INSTALLED_APPS中可以用该属性指定</td>
</tr>

<tr>
<td>db_table</td>
<td>模型使用的数据表名称</td>
</tr>

<tr>
<td>db_tablespace</td>
<td>模型使用的数据表空间</td>
</tr>

<tr>
<td>default_related_name</td>
<td>关联对象回指这个模型时默认使用的名称，默认为<model_name>_set</td>
</tr>

<tr>
<td>get_latest_by</td>
<td>模型中可排序字段的名称。</td>
</tr>

<tr>
<td>managed</td>
<td>设置为True时，Django在迁移中创建数据表并在执行flush管理命令时把表移除</td>
</tr>

<tr>
<td>order_with_respect_to</td>
<td>标记对象为可排序的</td>
</tr>

<tr>
<td>ordering</td>
<td>对象的默认排序</td>
</tr>

<tr>
<td>permissions</td>
<td>创建对象时写入权限表的额外权限</td>
</tr>

<tr>
<td>default_permissions</td>
<td>默认为<code>('add', 'change', 'delete')</code></td>
</tr>

<tr>
<td>unique_together</td>
<td>设定组合在一起时必须独一无二的字段名</td>
</tr>

<tr>
<td>index_together</td>
<td>设定一起建立索引的多个字段名</td>
</tr>

<tr>
<td>verbose_name</td>
<td>为对象设定人类可读的名称</td>
</tr>

<tr>
<td>verbose_name_plural</td>
<td>设定对象的复数名称</td>
</tr>
</tbody>
</table>

<h2 id="查询参考">查询参考</h2>

<p>按字段查找可以用的条件：</p>

<ol>
<li>exact / iexact：精确匹配/忽略大小写的精确匹配查询</li>
<li>contains / icontains / startswith / istartswith / endswith / iendswith：基于<code>like</code>的模糊查询</li>
<li>in：集合运算</li>
<li>gt / gte / lt / lte：大于/大于等于/小于/小于等于关系运算</li>
<li>range：指定范围查询（SQL中的<code>between…and…</code>）</li>
<li>year / month / day / week_day / hour / minute / second：查询时间日期</li>
<li>isnull：查询空值（True）或非空值（False）</li>
<li>search：基于全文索引的全文检索</li>
<li>regex / iregex：基于正则表达式的模糊匹配查询</li>
</ol>

<p>Q对象（用于执行复杂查询）的使用：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">&gt;&gt;&gt; from django.db.models import Q
&gt;&gt;&gt; Emp.objects.filter<span style="color:#f92672">(</span>
...     Q<span style="color:#f92672">(</span>name__startswith<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;张&#39;</span><span style="color:#f92672">)</span>,
...     Q<span style="color:#f92672">(</span>sal__gte<span style="color:#f92672">=</span><span style="color:#ae81ff">5000</span><span style="color:#f92672">)</span> | Q<span style="color:#f92672">(</span>comm__gte<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">)</span>
... <span style="color:#f92672">)</span> <span style="color:#75715e"># 查询名字以“张”开头且工资大于等于5000或补贴大于等于1000的员工</span>
&lt;QuerySet <span style="color:#f92672">[</span>&lt;Emp: 张三丰&gt;<span style="color:#f92672">]</span>&gt;</code></pre></div></article>

      

      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#深入模型">深入模型</a>
<ul>
<li><a href="#配置关系型数据库mysql">配置关系型数据库MySQL</a></li>
<li><a href="#利用django后台管理模型">利用Django后台管理模型</a></li>
<li><a href="#使用orm完成模型的crud操作">使用ORM完成模型的CRUD操作</a>
<ul>
<li><a href="#新增">新增</a></li>
<li><a href="#更新">更新</a></li>
<li><a href="#查询">查询</a></li>
<li><a href="#删除">删除</a></li>
</ul></li>
<li><a href="#django模型最佳实践">Django模型最佳实践</a></li>
<li><a href="#模型定义参考">模型定义参考</a>
<ul>
<li><a href="#字段">字段</a></li>
<li><a href="#字段属性">字段属性</a></li>
<li><a href="#模型元数据选项">模型元数据选项</a></li>
</ul></li>
<li><a href="#查询参考">查询参考</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
